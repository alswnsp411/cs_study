# DHCP가 무엇인지 설명해 주세요.  
DHCP(Dynamic Host Configuration Protocol,  동적 호스트 구성 프로토콜) 란 단어 그대로 **동적**으로 호스트를 설정하는 규약이다.  
네트워크 안에 컴퓨터에 네임 서버, IP, 게이트웨이등의 설정들을 자동적으로 제공해주는 **UDP 기반** 비연결형 서비스 프로토콜이다.  
IP를 필요로 하는 컴퓨터에게 자동으로 일정 기간 할당해서 사용할 수 있도록 해주고, 사용하지 않으면 반환받아 다른 컴퓨터가 사용할 수 있도록 해준다.  

<br />

PC의 수가 많거나 PC 자체 변동사항이 많은 경우 IP 설정이 자동으로 되기 때문에 효율적으로 사용 가능하고, IP를 자동으로 할당해주기 때문에 IP 충돌을 막을 수 있다. 
하지만, DHCP 서버에 의존하기 때문에 서버가 다운되면 ip 할당이 제대로 이루어지지 않는다.

<br />
<br />
  
### DHCP는 몇 계층 프로토콜인가요?

<br />
<br />

  
### DHCP는 어떻게 동작하나요?  
#### 임대(Lease)
IP는 임대받는 형식으로 할당된다. 클라이언트는 할당받은 주소를 사용하는 기간을 정하고, 기간이 끝나면 반환하게 된다.  
유동인구가 많은 카페 등에서는 짧고, 가정이나 기업 등에서는 긴 임대기간을 가지게 된다.  

<br />

![DHCP동작과정](https://github.com/kksshh0612/cs_study/assets/74577811/f95f02d4-2b31-4cf4-9248-690d7af8760e)  

<br/>

IP 임대 과정(DORA)  
- DHCP 서버가 여러 대일 경우를 대비해 설계되었기 때문에 모든 패킷이 브로드캐스팅된다.
- 임대 기간을 사용성에 맞게 잘 설정해 주어야 네트워크에 지장없이 사용이 가능하게 된다.

**1.DHCP Discover**
클라이언트는 MAC주소를 기반으로 네트워크에 DHCP 서버를 찾는 Discover 패킷을 브로드캐스팅(클라이언트 -> 네트워크 전체) 합니다.

> Ethernet Header {DA=FF:FF:FF:FF:FF:FF, SA=m1}  
> MAC Address로 FF:FF:FF:FF:FF:FF은 브로드 캐스트 주소 , m1은 클라이언트의 주소이다.  
> 
> IP Header {SIP=0.0.0.0, DIP=255.255.255.255}  
> IP Address로 0.0.0.0은 모르는 클라이언트 자신의 주소, 255.255.255.255는 브로드 캐스트 주소이다.  
> 
> Payload에는 패킷의 목적에 따른 사용자 데이터가 담긴다.  

**2. DHCP Offer**
DHCP 서버가 Discover 패킷을 받게되면 서버는 할당할 IP 주소 정보를 포함한 Offer 패킷을 브로드캐스팅(서버-> 네트워크 전체) 한다.

> Ethernet Header {DA=FF:FF:FF:FF:FF:FF, SA=m2}  
> MAC Address로 FF:FF:FF:FF:FF:FF은 브로드 캐스트 주소 , m2은 DHCP 서버의 주소이다.  
>
> IP Header {SIP=1.1.1.254, DIP=255.255.255.255}  
> IP Address로 1.1.1.254는 DHCP 서버의 주소, 255.255.255.255는 브로드 캐스트 주소이다.  
>
> DHCP Payload {Your IP=1.1.1.10, Client MAC=m1, Subnet Mask(1)=255.255.255.0, Router(3)=1.1.1.1,  
> DNS(6)=10.1.1.1&10.1.1.2, IP Lease Time(51)=3,600s, DHCP Server Identifier(54)=1.1.1.254}  
> 
> DHCP Payload의 정보를 기반으로 클라이언트는 네트워크 설정을 구성하고 통신을 시작할 수 있다.  
> 
> 클라이언트에게 할당된 IP 주소는 1.1.1.10이다. 클라이언트의 MAC 주소는 m1이다. 클라이언트가 사용할 서브넷 마스크는 255.255.255.0이다.  
> 클라이언트가 사용해야 할 기본 게이트웨이(라우터)의 IP주소는 1.1.1.1이다. 클라이언트가 사용할 DNS 서버의 IP주소는 10.1.1.1 와 10.1.1.2이다. 두 개의 DNS 서버가 제공되었다.  
> Lease Time은 클라이언트가 할당받은 IP 주소를 사용할 수 있는 시간을 나타낸다. 3600초(1시간)이다.  
> DHCP 서버의 식별자(IP주소)는 1.1.1.254이다.  

**3. DHCP Request**
DHCP 클라이언트는 DHCP Discover 메시지를 브로드캐스트하여 네트워크 내의 모든 DHCP 서버에 도움을 청하고, Offer 패킷을 받는다.    
클라이언트는 Request 패킷을 통해 Offer 패킷을 보낸 DHCP 서버들 중 하나를 선택하고, 사용할 네트워크 정보를 요청하며 브로드캐스팅(클라이언트-> 네트워크 전체)한다.  

> Ethernet Header {DA=FF:FF:FF:FF:FF:FF, SA=m1}  
> MAC Address로 FF:FF:FF:FF:FF:FF은 브로드 캐스트 주소 , m1은 클라이언트의 주소이다.  
>
> IP Header {SIP=0.0.0.0, DIP=255.255.255.255}  
> IP Address로 0.0.0.0은 모르는 클라이언트 자신의 주소, 255.255.255.255는 브로드 캐스트 주소이다.  
>
> DHCP Payload {Client MAC=m1, Requested IP Address(50)=1.1.1.10, DHCP Server Identifier(54)=1.1.1.254}  
>
> MAC 주소가 m1인 클라이언트가 IP 주소로 1.1.1.254를 갖는 DHCP 서버에게 특정 IP주소 (1.1.1.10)를 요청한다.  
> DHCP 서버는 이 정보를 기반으로 클라이언트에게 IP 주소를 할당하거나 거부할 수 있다.  

**4. DHCP Ack**
서버는 Request 패킷을 받으면 할당 가능한 IP를 pool에서 찾고, 네트워크 정보를 할당하는 Ack 패킷을 브로드캐스팅한다.    
이 패킷을 클라이언트가 받으면, IP 주소가 할당된다.

> Ethernet Header {DA=FF:FF:FF:FF:FF:FF, SA=m2}  
> MAC Address로 FF:FF:FF:FF:FF:FF은 브로드 캐스트 주소 , m2은 DHCP 서버의 주소이다.  
>
> IP Header {SIP=1.1.1.254, DIP=255.255.255.255}  
> IP Address로 1.1.1.254는 DHCP 서버의 주소, 255.255.255.255는 브로드 캐스트 주소이다.  
>
> DHCP Payload {Your IP=1.1.1.10, Client MAC=m1, Subnet Mask(1)=255.255.255.0, Router(3)=1.1.1.1,  
> DNS(6)=10.1.1.1&10.1.1.2, IP Lease Time(51)=3,600s, DHCP Server Identifier(54)=1.1.1.254}  
> 
> Payload에는 할당해주는 네트워크 구성 정보가 담겨있다.  

이 과정을 통해 클라이언트는 IP 주소 1.1.1.10으로 Internet Access 할 수 있다 !  

<br />

#### 갱신(Renewal)
클라이언트는 임대 기간이 끝나면 IP주소를 반환하는데, 네트워크를 계속 사용해야한다면 또 요청하고 할당받기까지 불필요한 브로드캐스팅 패킷이 발생하기 때문에 네트워크에 부담이 될 수 있다.  
그렇기 때문에 임대 기간이 50% 지났을 때와 87.5% 지났을 때, IP를 사용하고 있다면 서버에 갱신을 요청하고 갱신이 성공하면 임대 기간이 연장된다.  
갱신은 Unicast로 주고받으며, Request, Ack 두 개의 과정을 거친다.

<br />

#### 반환(Release)
임대 기간이 끝났거나, IP 주소를 더 사용하지 않는다면 IP주소를 DHCP 주소 pool에 반환하게 된다.
명령 프롬프트에서 ipconfig/release 명령으로 반환, ipconfig/renew 명령으로 임대 생성과 갱신을 할 수 있다.



<br />
<br />
  
### DHCP에서 UDP를 사용하는 이유가 무엇인가요?

<br />
<br />
  
### DHCP에서, IP 주소 말고 추가로 제공해주는 정보가 있나요?

<br />
<br />
  
### DHCP의 유효기간은 얼마나 긴가요?


<br />
<br />

<br />
--- 
<br />
네트워크 동작 과정 : https://mkrice.tistory.com/159
https://daengsik.tistory.com/16
