# DHCP가 무엇인지 설명해 주세요.

<br />
<br />
  
### DHCP는 몇 계층 프로토콜인가요?

<br />
<br />

  
### DHCP는 어떻게 동작하나요?  
#### 임대(Lease)
IP는 임대받는 형식으로 할당된다. 클라이언트는 할당받은 주소를 사용하는 기간을 정하고, 기간이 끝나면 반환하게 된다.  
유동인구가 많은 카페 등에서는 짧고, 가정이나 기업 등에서는 긴 임대기간을 가지게 된다.  

<br />

![DHCP동작과정](https://github.com/kksshh0612/cs_study/assets/74577811/f95f02d4-2b31-4cf4-9248-690d7af8760e)  

<br/>

IP 임대 과정(DORA)  
- DHCP 서버가 여러 대일 경우를 대비해 설계되었기 때문에 모든 패킷이 브로드캐스팅된다.
- 임대 기간을 사용성에 맞게 잘 설정해 주어야 네트워크에 지장없이 사용이 가능하게 된다.

**1.DHCP Discover**
클라이언트는 MAC주소를 기반으로 네트워크에 DHCP 서버를 찾는 Discover 패킷을 브로드캐스팅(클라이언트 -> 네트워크 전체) 합니다.

> Ethernet Header {DA=FF:FF:FF:FF:FF:FF, SA=m1}
> MAC Address로 FF:FF:FF:FF:FF:FF은 브로드 캐스트 주소 , m1은 클라이언트의 주소이다.
> 
> IP Header {SIP=0.0.0.0, DIP=255.255.255.255}
> IP Address로 0.0.0.0은 모르는 클라이언트 자신의 주소, 255.255.255.255는 브로드 캐스트 주소이다.
> 
> Payload에는 패킷의 목적에 따른 사용자 데이터가 담긴다.

**2. DHCP Offer**
DHCP 서버가 Discover 패킷을 받게되면 서버는 할당할 IP 주소 정보를 포함한 Offer 패킷을 브로드캐스팅(서버-> 네트워크 전체) 한다.

> Ethernet Header {DA=FF:FF:FF:FF:FF:FF, SA=m2}
> MAC Address로 FF:FF:FF:FF:FF:FF은 브로드 캐스트 주소 , m2은 DHCP 서버의 주소이다.
>
> IP Header {SIP=1.1.1.254, DIP=255.255.255.255}
> IP Address로 1.1.1.254는 DHCP 서버의 주소, 255.255.255.255는 브로드 캐스트 주소이다.
>
> DHCP Payload {Your IP=1.1.1.10, Client MAC=m1, Subnet Mask(1)=255.255.255.0, Router(3)=1.1.1.1,
> DNS(6)=10.1.1.1&10.1.1.2, IP Lease Time(51)=3,600s, DHCP Server Identifier(54)=1.1.1.254}
> 
> DHCP Payload의 정보를 기반으로 클라이언트는 네트워크 설정을 구성하고 통신을 시작할 수 있다.
> 
> 클라이언트에게 할당된 IP 주소는 1.1.1.10이다. 클라이언트의 MAC 주소는 m1이다. 클라이언트가 사용할 서브넷 마스크는 255.255.255.0이다.
> 클라이언트가 사용해야 할 기본 게이트웨이(라우터)의 IP주소는 1.1.1.1이다. 클라이언트가 사용할 DNS 서버의 IP주소는 10.1.1.1 와 10.1.1.2이다. 두 개의 DNS 서버가 제공되었다.
> Lease Time은 클라이언트가 할당받은 IP 주소를 사용할 수 있는 시간을 나타낸다. 3600초(1시간)이다.
> DHCP 서버의 식별자(IP주소)는 1.1.1.254이다.

**3. DHCP Request**
DHCP 클라이언트는 DHCP Discover 메시지를 브로드캐스트하여 네트워크 내의 모든 DHCP 서버에 도움을 청하고, Offer 패킷을 받는다.  
클라이언트는 Request 패킷을 통해 Offer 패킷을 보낸 DHCP 서버들 중 하나를 선택하고, 사용할 네트워크 정보를 요청하며 브로드캐스팅(클라이언트-> 네트워크 전체)한다.

> Ethernet Header {DA=FF:FF:FF:FF:FF:FF, SA=m1}
> MAC Address로 FF:FF:FF:FF:FF:FF은 브로드 캐스트 주소 , m1은 클라이언트의 주소이다.
>
> IP Header {SIP=0.0.0.0, DIP=255.255.255.255}
> IP Address로 0.0.0.0은 모르는 클라이언트 자신의 주소, 255.255.255.255는 브로드 캐스트 주소이다.
>
> DHCP Payload {Client MAC=m1, Requested IP Address(50)=1.1.1.10, DHCP Server Identifier(54)=1.1.1.254}
>
> MAC 주소가 m1인 클라이언트가 IP 주소로 1.1.1.254를 갖는 DHCP 서버에게 특정 IP주소 (1.1.1.10)를 요청한다.
> DHCP 서버는 이 정보를 기반으로 클라이언트에게 IP 주소를 할당하거나 거부할 수 있다.

**4. DHCP Ack**
서버는 Request 패킷을 받으면 할당 가능한 IP를 pool에서 찾고, 네트워크 정보를 할당하는 Ack 패킷을 브로드캐스팅한다.  
이 패킷을 클라이언트가 받으면, IP 주소가 할당된다.

> Ethernet Header {DA=FF:FF:FF:FF:FF:FF, SA=m2}
> MAC Address로 FF:FF:FF:FF:FF:FF은 브로드 캐스트 주소 , m2은 DHCP 서버의 주소이다.
>
> IP Header {SIP=1.1.1.254, DIP=255.255.255.255}
> IP Address로 1.1.1.254는 DHCP 서버의 주소, 255.255.255.255는 브로드 캐스트 주소이다.
>
> DHCP Payload {Your IP=1.1.1.10, Client MAC=m1, Subnet Mask(1)=255.255.255.0, Router(3)=1.1.1.1,
> DNS(6)=10.1.1.1&10.1.1.2, IP Lease Time(51)=3,600s, DHCP Server Identifier(54)=1.1.1.254}
> 
> Payload에는 할당해주는 네트워크 구성 정보가 담겨있다.

이 과정을 통해 클라이언트는 IP 주소 1.1.1.10으로 Internet Access 할 수 있다 !

<br />
<br />
  
### DHCP에서 UDP를 사용하는 이유가 무엇인가요?

<br />
<br />
  
### DHCP에서, IP 주소 말고 추가로 제공해주는 정보가 있나요?

<br />
<br />
  
### DHCP의 유효기간은 얼마나 긴가요?


<br />
<br />

<br />
--- 
<br />
네트워크 동작 과정 : https://mkrice.tistory.com/159
https://daengsik.tistory.com/16
